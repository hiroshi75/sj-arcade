<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dusty Trails - Sheriff Jim's Retro Arcade</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0a;
            min-height: 100vh;
            font-family: 'Press Start 2P', cursive;
            color: #33ff33;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        #game-container {
            width: 100%;
            max-width: 900px;
            background: #111;
            border: 4px solid #33ff33;
            box-shadow: 0 0 20px rgba(51, 255, 51, 0.3), inset 0 0 100px rgba(0,0,0,0.5);
            padding: 20px;
            position: relative;
        }
        /* CRT effect */
        #game-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0,0,0,0.1) 0px,
                rgba(0,0,0,0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
        }
        header {
            text-align: center;
            border-bottom: 2px solid #33ff33;
            padding-bottom: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        header h1 {
            font-size: 24px;
            color: #ffcc00;
        }
        #lang-toggle {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #1a1a1a;
            border: 2px solid #33ff33;
            color: #33ff33;
            padding: 5px 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            cursor: pointer;
        }
        #lang-toggle:hover {
            background: #33ff33;
            color: #0a0a0a;
            text-shadow: 2px 2px #8B4513;
            margin-bottom: 5px;
        }
        header .subtitle {
            font-size: 10px;
            color: #33ff33;
        }
        /* Stats bar */
        #stats-bar {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            padding: 10px;
            background: #1a1a1a;
            border: 2px solid #33ff33;
            margin-bottom: 15px;
            font-size: 10px;
        }
        #stats-bar.visible { display: grid; }
        .stat-value.rep-good { color: #33ff33; }
        .stat-value.rep-bad { color: #ff3333; }
        .stat-value.rep-neutral { color: #ffcc00; }
        .stat { display: flex; justify-content: space-between; }
        .stat-label { color: #999; }
        .stat-value { color: #ffcc00; }
        .stat-value.hp { color: #ff3333; }
        .stat-value.gold { color: #ffcc00; }
        /* Main content */
        #story-area {
            min-height: 300px;
            padding: 15px;
            background: #0a0a0a;
            border: 1px solid #333;
            margin-bottom: 15px;
            font-size: 11px;
            line-height: 1.8;
            overflow-y: auto;
            max-height: 400px;
        }
        #story-area p { margin-bottom: 15px; }
        #story-area .narrator { color: #33ff33; }
        #story-area .dialogue { color: #ffcc00; font-style: italic; }
        #story-area .system { color: #ff6600; }
        #story-area .combat { color: #ff3333; }
        #story-area .loot { color: #00ffff; }
        #story-area .choice-result { color: #ff66ff; }
        /* Choices */
        #choices-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .choice-btn {
            background: #1a1a1a;
            border: 2px solid #33ff33;
            color: #33ff33;
            padding: 12px 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.1s;
        }
        .choice-btn:hover {
            background: #33ff33;
            color: #0a0a0a;
        }
        .choice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .choice-btn .key {
            color: #ffcc00;
            margin-right: 10px;
        }
        .choice-btn:hover .key { color: #0a0a0a; }
        /* Character creation */
        #char-create {
            text-align: center;
        }
        #char-create h2 {
            color: #ffcc00;
            font-size: 14px;
            margin-bottom: 20px;
        }
        #char-create input {
            background: #1a1a1a;
            border: 2px solid #33ff33;
            color: #33ff33;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
            text-align: center;
        }
        #char-create input::placeholder { color: #555; }
        .class-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .class-card {
            background: #1a1a1a;
            border: 2px solid #555;
            padding: 15px;
            cursor: pointer;
            transition: all 0.1s;
        }
        .class-card:hover, .class-card.selected {
            border-color: #ffcc00;
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }
        .class-card .icon { font-size: 32px; margin-bottom: 10px; }
        .class-card .name { color: #ffcc00; font-size: 12px; margin-bottom: 8px; }
        .class-card .desc { color: #999; font-size: 8px; line-height: 1.6; }
        .class-card .stats-preview { color: #33ff33; font-size: 8px; margin-top: 10px; }
        /* Combat UI */
        #combat-area {
            display: none;
            background: #1a0a0a;
            border: 2px solid #ff3333;
            padding: 15px;
            margin-bottom: 15px;
        }
        #combat-area.visible { display: block; }
        .combat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 12px;
        }
        .combatant {
            text-align: center;
        }
        .combatant .name { color: #ffcc00; margin-bottom: 5px; }
        .combatant .hp-bar {
            width: 150px;
            height: 15px;
            background: #333;
            border: 1px solid #ff3333;
            margin: 0 auto;
        }
        .combatant .hp-fill {
            height: 100%;
            background: #ff3333;
            transition: width 0.3s;
        }
        .combatant .hp-text { font-size: 10px; color: #ff3333; margin-top: 5px; }
        .vs { color: #ff3333; font-size: 20px; }
        #combat-log {
            background: #0a0a0a;
            padding: 10px;
            font-size: 9px;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        #combat-log p { margin: 5px 0; }
        /* Inventory */
        #inventory {
            display: none;
            background: #1a1a0a;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin-bottom: 15px;
        }
        #inventory.visible { display: block; }
        #inventory h3 { color: #ffcc00; font-size: 12px; margin-bottom: 10px; }
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        .item-slot {
            background: #0a0a0a;
            border: 1px solid #555;
            padding: 10px;
            text-align: center;
            font-size: 8px;
        }
        .item-slot .item-icon { font-size: 24px; margin-bottom: 5px; }
        .item-slot .item-name { color: #ffcc00; }
        .item-slot .item-qty { color: #33ff33; }
        /* Game over */
        #game-over {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.95);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 100;
        }
        #game-over.visible { display: flex; }
        #game-over h1 { color: #ff3333; font-size: 24px; margin-bottom: 20px; }
        #game-over.victory h1 { color: #ffcc00; }
        #game-over p { color: #999; font-size: 10px; margin: 10px 0; }
        #game-over .final-stats { color: #33ff33; margin: 20px 0; }
        .restart-btn {
            background: #33ff33;
            color: #0a0a0a;
            border: none;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            margin-top: 20px;
        }
        .restart-btn:hover { background: #66ff66; }
        /* Dice roll animation */
        .dice-roll {
            display: inline-block;
            animation: shake 0.3s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }
        /* Mobile responsive */
        @media (max-width: 480px) {
            body { padding: 10px; }
            #game-container { padding: 10px; }
            header h1 { font-size: 14px; }
            header .subtitle { font-size: 8px; }
            #lang-toggle { font-size: 7px; padding: 4px 8px; }
            #stats-bar { 
                grid-template-columns: repeat(3, 1fr); 
                font-size: 8px; 
                gap: 5px; 
                padding: 8px;
            }
            #story-area { 
                font-size: 9px; 
                padding: 10px; 
                min-height: 200px; 
                max-height: 300px;
                line-height: 1.6;
            }
            .choice-btn { font-size: 9px; padding: 10px; }
            .choice-btn .key { margin-right: 5px; }
            #char-create h2 { font-size: 11px; }
            #char-create input { font-size: 10px; padding: 8px; }
            .class-select { grid-template-columns: 1fr; gap: 10px; }
            .class-card { padding: 12px; }
            .class-card .icon { font-size: 24px; }
            .class-card .name { font-size: 10px; }
            .class-card .desc { font-size: 7px; }
            .class-card .stats-preview { font-size: 7px; }
            .combat-header { flex-wrap: wrap; justify-content: center; gap: 10px; }
            .combatant .hp-bar { width: 100px; height: 12px; }
            .combatant .hp-text { font-size: 8px; }
            .vs { font-size: 16px; width: 100%; text-align: center; }
            #combat-log { font-size: 8px; max-height: 100px; }
            #inventory h3 { font-size: 10px; }
            .inventory-grid { grid-template-columns: repeat(3, 1fr); }
            .item-slot { padding: 8px; font-size: 7px; }
            .item-slot .item-icon { font-size: 18px; }
            #game-over h1 { font-size: 16px; }
            #game-over p { font-size: 8px; }
            .restart-btn { font-size: 10px; padding: 12px 20px; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <header>
            <button id="lang-toggle" onclick="toggleLang()">üáØüáµ JP</button>
            <h1>üåµ DUSTY TRAILS üåµ</h1>
            <div class="subtitle" id="subtitle">A Western Text Adventure</div>
        </header>
        
        <div id="stats-bar">
            <div class="stat"><span class="stat-label">HP</span><span class="stat-value hp" id="hp">--</span></div>
            <div class="stat"><span class="stat-label">STR</span><span class="stat-value" id="str">--</span></div>
            <div class="stat"><span class="stat-label">DEX</span><span class="stat-value" id="dex">--</span></div>
            <div class="stat"><span class="stat-label">LCK</span><span class="stat-value" id="lck">--</span></div>
            <div class="stat"><span class="stat-label">GOLD</span><span class="stat-value gold" id="gold">--</span></div>
            <div class="stat"><span class="stat-label">REP</span><span class="stat-value rep-neutral" id="rep">--</span></div>
        </div>
        
        <div id="combat-area">
            <div class="combat-header">
                <div class="combatant player">
                    <div class="name" id="player-name">Player</div>
                    <div class="hp-bar"><div class="hp-fill" id="player-hp-bar"></div></div>
                    <div class="hp-text"><span id="player-hp-text">--</span> HP</div>
                </div>
                <div class="vs">‚öîÔ∏è</div>
                <div class="combatant enemy">
                    <div class="name" id="enemy-name">Enemy</div>
                    <div class="hp-bar"><div class="hp-fill" id="enemy-hp-bar"></div></div>
                    <div class="hp-text"><span id="enemy-hp-text">--</span> HP</div>
                </div>
            </div>
            <div id="combat-log"></div>
        </div>
        
        <div id="inventory">
            <h3>üéí INVENTORY</h3>
            <div class="inventory-grid" id="inventory-grid"></div>
        </div>
        
        <div id="story-area"></div>
        
        <div id="choices-area"></div>
        
        <div id="game-over">
            <h1 id="go-title">GAME OVER</h1>
            <p id="go-message"></p>
            <div class="final-stats" id="go-stats"></div>
            <button class="restart-btn" onclick="startGame()">‚ñ∂ NEW GAME</button>
        </div>
    </div>
    
    <script>
        // === SOUND SYSTEM ===
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        
        function initAudio() {
            if (!audioCtx) audioCtx = new AudioCtx();
        }
        
        function playSound(type) {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            switch(type) {
                case 'gunshot':
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'coin':
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                    osc.frequency.setValueAtTime(1200, audioCtx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'hit':
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.15);
                    gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.15);
                    break;
                case 'victory':
                    [523, 659, 784].forEach((freq, i) => {
                        const o = audioCtx.createOscillator();
                        const g = audioCtx.createGain();
                        o.connect(g); g.connect(audioCtx.destination);
                        o.type = 'sine';
                        o.frequency.value = freq;
                        g.gain.setValueAtTime(0.15, audioCtx.currentTime + i * 0.15);
                        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.15 + 0.3);
                        o.start(audioCtx.currentTime + i * 0.15);
                        o.stop(audioCtx.currentTime + i * 0.15 + 0.3);
                    });
                    break;
                case 'death':
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(300, audioCtx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
                    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'click':
                    osc.type = 'sine';
                    osc.frequency.value = 600;
                    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.05);
                    break;
            }
        }
        
        // Language system
        let lang = localStorage.getItem('dustyTrails_lang') || 'en';
        
        const TEXTS = {
            en: {
                subtitle: 'A Western Text Adventure',
                createChar: 'üåÖ CREATE YOUR CHARACTER üåÖ',
                yearIs: 'The year is 1885. The frontier awaits...',
                enterName: 'Enter your name',
                choosePath: 'Choose your path:',
                beginJourney: 'Begin Your Journey',
                introText: (name, className) => `The stagecoach drops you at the edge of <span style="color:#ffcc00">DUSTY GULCH</span>, a town forgotten by civilization but not by trouble. You're ${name}, a ${className}. The wind carries whispers of gold, danger, and opportunity.`,
                welcome: '"Welcome to Dusty Gulch, stranger. Watch your back."',
                mainStreet: 'The dusty main street stretches before you. A saloon, general store, and sheriff\'s office line the road.',
                saloon: 'üç∫ Enter the Saloon',
                store: 'üè™ Visit the General Store',
                sheriff: '‚≠ê Go to the Sheriff\'s Office',
                wilderness: 'üåµ Head out of town',
                saloonEnter: 'The saloon doors swing open. Piano music fills the smoky air. Cowboys eye you suspiciously.',
                bartender: '"What\'ll it be, stranger?"',
                roughMan: 'A rough-looking man in the corner stares at you menacingly...',
                buyDrink: 'ü•É Buy a drink ($5)',
                playPoker: 'üé∞ Play poker ($10)',
                listenRumors: 'üëÇ Listen to rumors',
                leave: 'üö™ Leave',
                confrontStranger: '‚öîÔ∏è Confront the stranger',
                drinkText: 'You slide 5 gold across the bar. The whiskey burns going down but warms your soul.',
                hpRestored: '+10 HP restored',
                bountyInfo: '"You look like someone who can handle trouble," the bartender whispers. "Word is, there\'s a bounty on Black Pete. $100 gold, dead or alive. He\'s holed up in the canyon east of here."',
                askBlackPete: 'üëÇ Ask about Black Pete',
                pokerSit: 'You sit at the poker table. Cards are dealt...',
                luckRoll: 'Luck roll',
                jackpot: 'üéâ JACKPOT! You clean out the table! +$30 gold!',
                winHand: 'You win the hand! +$10 gold',
                breakEven: 'You break even. The cards weren\'t with you today.',
                badLuck: 'Bad luck! You lose $10 gold.',
                playAgain: 'üé∞ Play again ($10)',
                leaveTable: 'üö™ Leave the table',
                rumors: ['They say there\'s gold in Dead Man\'s Canyon, but nobody who goes there comes back...',
                    'The sheriff ain\'t what he seems. Heard he\'s in with the gang.',
                    'A prospector found a huge nugget last week. He\'s staying at the inn, flashing it around like a fool.',
                    'Wolves have been attacking travelers on the north road. Be careful out there.',
                    'Black Pete\'s gang robbed the bank last month. $1000 still missing.'],
                listenMore: 'üëÇ Listen more',
                storeEnter: 'The general store is cramped but well-stocked. An old man peers at you from behind the counter.',
                storeKeeper: '"See anything you like? Fair prices, I promise."',
                buyBandage: 'ü©π Buy Bandage ($15)',
                buyWhiskey: 'ü•É Buy Whiskey ($10)',
                buyDynamite: 'üß® Buy Dynamite ($25)',
                sellItems: 'üí∞ Sell items',
                purchased: 'You purchased',
                buyMore: 'üõí Buy more',
                sheriffOffice: 'The sheriff\'s office is quiet. Wanted posters line the walls.',
                fellowLawman: 'The deputy recognizes your badge. "A fellow lawman! Welcome!"',
                bounties: 'BOUNTIES:',
                bountyPete: 'üéØ Black Pete - $100 (Dangerous outlaw)',
                bountyWolves: 'üéØ Wolf Pack - $30 (Clear the north road)',
                bountySnakes: 'üéØ Snake Nest - $20 (Desert cleanup)',
                huntPete: 'üéØ Hunt Black Pete',
                huntWolves: 'üê∫ Hunt the Wolf Pack',
                huntSnakes: 'üêç Clear the Snake Nest',
                wildernessText: 'You venture into the dusty plains. The sun beats down mercilessly.',
                wolfAppears: 'üê∫ A wild wolf appears!',
                foundCamp: 'You wander the wilderness and find an abandoned campsite.',
                foundGold: (gold) => `You found ${gold} gold in an old saddlebag!`,
                wildernessStretch: 'The wilderness stretches endlessly. Cacti dot the landscape.',
                seeCanyon: 'In the distance, you see the canyon where Black Pete is said to hide...',
                continueExploring: 'üèúÔ∏è Continue exploring',
                headCanyon: '‚õ∞Ô∏è Head to the canyon',
                returnTown: 'üè† Return to town',
                canyonEnter: 'The canyon walls rise high above you. This is outlaw territory.',
                spotSmoke: 'You spot campfire smoke deeper in the canyon. Black Pete\'s hideout must be close.',
                dangerWarning: '‚ö†Ô∏è WARNING: Dangerous area ahead!',
                stormCamp: 'üî´ Storm the camp',
                sneakApproach: 'ü§´ Sneak approach',
                useDynamite: 'üß® Use dynamite (if you have it)',
                retreat: 'üèÉ Retreat',
                chargeIn: 'You charge into the camp, guns blazing!',
                whoDares: '"Who dares?!" Black Pete draws his weapon.',
                bossBattle: '‚öîÔ∏è BOSS BATTLE: BLACK PETE!',
                sneakShadows: 'You slip through the shadows like a ghost...',
                sneakRoll: 'Sneak roll',
                sneakSuccess: 'SUCCESS!',
                foundStash: 'You found Pete\'s stash! +$50 gold!',
                peteSpots: 'But Pete spots you as you leave!',
                sneakFailed: 'FAILED!',
                steppedTwig: 'You try to sneak but step on a twig...',
                beenSpotted: 'You\'ve been spotted!',
                lightDynamite: 'You light the dynamite and hurl it into the camp!',
                boom: 'üí• BOOM! The explosion rocks the canyon!',
                peteTakes40: 'Black Pete takes 40 damage!',
                peteEmerges: 'Wounded but alive, Pete emerges from the smoke...',
                trackWolves: 'You track the wolf pack to the north road...',
                alphaAttacks: 'üê∫ The alpha wolf attacks!',
                findSnakes: 'You find the snake nest in the desert rocks...',
                snakeStrikes: 'üêç A rattlesnake strikes!',
                victory: 'üèÜ Victory!',
                youDefeated: (name) => `You defeated the ${name}!`,
                goldEarned: (gold) => `+${gold} gold earned!`,
                repGain: '‚≠ê Reputation +5 (brought outlaw to justice)',
                bountyCollected: 'üí∞ BOUNTY COLLECTED: +$100 gold!',
                repLegend: '‚≠ê Reputation +50 (legendary feat!)',
                continueExplore: 'üèúÔ∏è Continue exploring',
                attack: '‚öîÔ∏è Attack',
                defend: 'üõ°Ô∏è Defend',
                useBandage: 'ü©π Use Bandage',
                drinkWhiskey: 'ü•É Drink Whiskey',
                throwDynamite: 'üß® Throw Dynamite',
                hitRoll: 'Hit roll',
                hit: 'HIT!',
                critical: 'CRITICAL!',
                youDeal: 'You deal',
                damage: 'damage!',
                miss: 'MISS!',
                attacks: 'attacks!',
                youTake: 'You take',
                defended: '(defended)',
                dodged: 'but you dodge!',
                braceAttack: 'You brace for the attack...',
                usedBandage: 'ü©π You use a bandage! +20 HP',
                drankWhiskey: 'ü•É Whiskey! +15 HP, +2 STR!',
                dynamiteBoom: 'üß® BOOM! 40 damage!',
                enemyStunned: 'Enemy is stunned!',
                stoleGold: (gold) => `üí∞ Stole ${gold} gold!`,
                gameOver: 'üíÄ GAME OVER',
                metEnd: (name, className) => `${name} met their end in the dusty frontier...`,
                gold: 'Gold',
                enemiesDefeated: 'Enemies Defeated',
                daysSurvived: 'Days Survived',
                newGame: '‚ñ∂ NEW GAME',
                playAgainBtn: 'üîÑ Play Again',
                endingTitle: 'üåÖ THE END üåÖ',
                endingText: (name) => `The dust settles over the canyon. Black Pete lies defeated at your feet. Word of your victory spreads like wildfire across the frontier. When you return to Dusty Gulch, the townsfolk gather in the streets.`,
                endingGasp: '"You... you\'re faster than anyone I\'ve ever seen,"',
                endingCheers: (name) => `"Three cheers for ${name}!" the crowd roars.`,
                endingMayor: '"This town owes you everything. From this day forward, you are the true law of Dusty Gulch."',
                legendWest: 'üèÜ YOU ARE NOW A LEGEND OF THE WEST! üèÜ',
                finalStats: 'Final Stats:',
                reputation: 'Reputation',
                remember: 'The frontier will remember your name forever...'
            },
            jp: {
                subtitle: 'Ë•øÈÉ®„ÉÜ„Ç≠„Çπ„Éà„Ç¢„Éâ„Éô„É≥„ÉÅ„É£„Éº',
                createChar: 'üåÖ „Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê üåÖ',
                yearIs: '1885Âπ¥„ÄÇ„Éï„É≠„É≥„ÉÜ„Ç£„Ç¢„ÅåÂæÖ„Å£„Å¶„ÅÑ„Çã...',
                enterName: 'ÂêçÂâç„ÇíÂÖ•Âäõ',
                choosePath: 'ÈÅì„ÇíÈÅ∏„Åπ:',
                beginJourney: 'ÂÜíÈô∫„ÇíÂßã„ÇÅ„Çã',
                introText: (name, className) => `ÈßÖÈ¶¨Ëªä„Åå<span style="color:#ffcc00">DUSTY GULCH</span>„ÅÆÁî∫„ÅØ„Åö„Çå„Å´Âà∞ÁùÄ„Åó„Åü„ÄÇÊñáÊòé„Å´Âøò„ÇåÂéª„Çâ„Çå„ÄÅ„Åó„Åã„Åó„Éà„É©„Éñ„É´„Å´„ÅØÂøò„Çå„Çâ„Çå„Å¶„ÅÑ„Å™„ÅÑÁî∫„Å†„ÄÇÂêõ„ÅØ${name}„ÄÅ${className}„Å†„ÄÇÈ¢®„ÅØÈáë„ÄÅÂç±Èô∫„ÄÅ„Åù„Åó„Å¶„ÉÅ„É£„É≥„Çπ„ÅÆÂôÇ„ÇíÈÅã„Çì„Åß„Åè„Çã„ÄÇ`,
                welcome: '„Äå„Çà„ÅÜ„Åì„ÅùDusty Gulch„Å∏„ÄÅ„Çà„ÅùËÄÖ„Åï„Çì„ÄÇËÉå‰∏≠„Å´Ê∞ó„Çí„Å§„Åë„Å™„Äç',
                mainStreet: 'ÂüÉ„Å£„ÅΩ„ÅÑ„É°„Ç§„É≥„Çπ„Éà„É™„Éº„Éà„ÅåÁõÆ„ÅÆÂâç„Å´Â∫É„Åå„Çã„ÄÇÈÖíÂ†¥„ÄÅÈõëË≤®Â∫ó„ÄÅ‰øùÂÆâÂÆò‰∫ãÂãôÊâÄ„ÅåÈÅìÊ≤ø„ÅÑ„Å´‰∏¶„Çì„Åß„ÅÑ„Çã„ÄÇ',
                saloon: 'üç∫ ÈÖíÂ†¥„Å´ÂÖ•„Çã',
                store: 'üè™ ÈõëË≤®Â∫ó„Å´Ë°å„Åè',
                sheriff: '‚≠ê ‰øùÂÆâÂÆò‰∫ãÂãôÊâÄ„Å´Ë°å„Åè',
                wilderness: 'üåµ Áî∫„ÇíÂá∫„Çã',
                saloonEnter: 'ÈÖíÂ†¥„ÅÆÊââ„ÅåÈñã„Åè„ÄÇ„Éî„Ç¢„Éé„ÅÆÈü≥„ÅåÁÖô„Åü„ÅÑÁ©∫Ê∞ó„Å´Èüø„Åè„ÄÇ„Ç´„Ç¶„Éú„Éº„Ç§„Åü„Å°„ÅåÊÄ™„Åó„Åí„Å™ÁõÆ„ÅßÂêõ„ÇíË¶ã„Çã„ÄÇ',
                bartender: '„Äå‰Ωï„Å´„Åô„Çã„ÄÅ„Çà„ÅùËÄÖ„Åï„ÇìÔºü„Äç',
                roughMan: 'ÈöÖ„Å´„ÅÑ„ÇãËçí„Åè„ÇåËÄÖ„ÅåÂêõ„ÇíÁù®„Çì„Åß„ÅÑ„Çã...',
                buyDrink: 'ü•É ÈÖí„ÇíË≤∑„ÅÜ ($5)',
                playPoker: 'üé∞ „Éù„Éº„Ç´„Éº„Çí„Åô„Çã ($10)',
                listenRumors: 'üëÇ ÂôÇ„ÇíËÅû„Åè',
                leave: 'üö™ Âá∫„Çã',
                confrontStranger: '‚öîÔ∏è „Çà„ÅùËÄÖ„Å´Á´ã„Å°Âêë„Åã„ÅÜ',
                drinkText: '„Ç´„Ç¶„É≥„Çø„Éº„Å´5„Ç¥„Éº„É´„Éâ„ÇíÁΩÆ„Åè„ÄÇ„Ç¶„Ç§„Çπ„Ç≠„Éº„ÅØÂñâ„ÇíÁÑº„Åè„Åå„ÄÅÂøÉ„ÇíÊ∏©„ÇÅ„Çã„ÄÇ',
                hpRestored: '+10 HPÂõûÂæ©',
                bountyInfo: '„Äå„ÅäÂâç„Åï„Çì„ÅØ„Éà„É©„Éñ„É´„Å´ÂØæÂá¶„Åß„Åç„Åù„ÅÜ„Å†„Å™„Äç„Å®„Éê„Éº„ÉÜ„É≥„ÉÄ„Éº„Åå„Åï„Åï„ÇÑ„Åè„ÄÇ„ÄåBlack Pete„Å´Ë≥ûÈáë„Åå„Åã„Åã„Å£„Å¶„Çã„Åú„ÄÇ100„Ç¥„Éº„É´„Éâ„ÄÅÁîüÊ≠ªÂïè„Çè„Åö„ÄÇÊù±„ÅÆÂ≥°Ë∞∑„Å´ÊΩú„Çì„Åß„ÅÑ„Çã„Çâ„Åó„ÅÑ„Äç',
                askBlackPete: 'üëÇ Black Pete„Å´„Å§„ÅÑ„Å¶ËÅû„Åè',
                pokerSit: '„Éù„Éº„Ç´„Éº„ÉÜ„Éº„Éñ„É´„Å´Â∫ß„Çã„ÄÇ„Ç´„Éº„Éâ„ÅåÈÖç„Çâ„Çå„Åü...',
                luckRoll: 'ÈÅãË©¶„Åó',
                jackpot: 'üéâ Â§ßÂΩì„Åü„ÇäÔºÅ„ÉÜ„Éº„Éñ„É´„Çí‰∏ÄÊéÉ„Åó„ÅüÔºÅ+$30„Ç¥„Éº„É´„ÉâÔºÅ',
                winHand: 'Âãù„Å£„ÅüÔºÅ+$10„Ç¥„Éº„É´„Éâ',
                breakEven: 'Âºï„ÅçÂàÜ„Åë„ÄÇ‰ªäÊó•„ÅØ„ÉÑ„Ç§„Å¶„Å™„ÅÑ„Å™„ÄÇ',
                badLuck: 'ÈÅã„ÅåÊÇ™„ÅÑÔºÅ$10„Ç¥„Éº„É´„ÉâÂ§±„Å£„Åü„ÄÇ',
                playAgain: 'üé∞ „ÇÇ„ÅÜ‰∏ÄÂ∫¶ ($10)',
                leaveTable: 'üö™ „ÉÜ„Éº„Éñ„É´„ÇíÈõ¢„Çå„Çã',
                rumors: ['Dead Man\'s Canyon„Å´„ÅØÈáë„Åå„ÅÇ„Çã„Çâ„Åó„ÅÑ„Åå„ÄÅË°å„Å£„ÅüËÄÖ„ÅØË™∞„ÇÇÊàª„Å£„Å¶„Åì„Å™„ÅÑ...',
                    '‰øùÂÆâÂÆò„ÅØË¶ã„Åã„ÅëÈÄö„Çä„Åò„ÇÉ„Å™„ÅÑ„ÄÇ„ÇÆ„É£„É≥„Ç∞„Å®„Å§„Çã„Çì„Åß„Çã„Å£„Å¶Ë©±„Å†„ÄÇ',
                    'ÂÖàÈÄ±„ÄÅÊé°ÊéòËÄÖ„ÅåÂ∑®Â§ß„Å™ÈáëÂ°ä„ÇíË¶ã„Å§„Åë„Åü„ÄÇÂÆøÂ±ã„ÅßË¶ã„Åõ„Å≥„Çâ„Åã„Åó„Å¶„Çã„Éê„Ç´„Å†„ÄÇ',
                    'Âåó„ÅÆÈÅì„Åß„Ç™„Ç™„Ç´„Éü„ÅåÊóÖ‰∫∫„ÇíË•≤„Å£„Å¶„ÅÑ„Çã„ÄÇÊ∞ó„Çí„Å§„Åë„Çç„Çà„ÄÇ',
                    'Black Pete„ÅÆ„ÇÆ„É£„É≥„Ç∞„ÅåÂÖàÊúàÈäÄË°å„ÇíË•≤„Å£„Åü„ÄÇ$1000„Åå„Åæ„Å†Ë°åÊñπ‰∏çÊòé„Å†„ÄÇ'],
                listenMore: 'üëÇ „ÇÇ„Å£„Å®ËÅû„Åè',
                storeEnter: 'ÈõëË≤®Â∫ó„ÅØÁã≠„ÅÑ„ÅåÂìÅÊèÉ„Åà„ÅØË±äÂØå„Å†„ÄÇËÄÅ‰∫∫„Åå„Ç´„Ç¶„É≥„Çø„Éº„ÅÆÂêë„Åì„ÅÜ„Åã„ÇâÂêõ„ÇíË¶ã„Å¶„ÅÑ„Çã„ÄÇ',
                storeKeeper: '„Äå‰Ωï„Åã„ÅäÊ∞ó„Å´Âè¨„Åô„ÇÇ„ÅÆ„ÅØÔºüÊ≠£Áõ¥„Å™ÂÄ§ÊÆµ„Å†„Çà„Äç',
                buyBandage: 'ü©π ÂåÖÂ∏Ø„ÇíË≤∑„ÅÜ ($15)',
                buyWhiskey: 'ü•É „Ç¶„Ç§„Çπ„Ç≠„Éº„ÇíË≤∑„ÅÜ ($10)',
                buyDynamite: 'üß® „ÉÄ„Ç§„Éä„Éû„Ç§„Éà„ÇíË≤∑„ÅÜ ($25)',
                sellItems: 'üí∞ „Ç¢„Ç§„ÉÜ„É†„ÇíÂ£≤„Çã',
                purchased: 'Ë≥ºÂÖ•„Åó„ÅüÔºö',
                buyMore: 'üõí „ÇÇ„Å£„Å®Ë≤∑„ÅÜ',
                sheriffOffice: '‰øùÂÆâÂÆò‰∫ãÂãôÊâÄ„ÅØÈùô„Åã„Å†„ÄÇÂ£Å„Å´„ÅØÊåáÂêçÊâãÈÖç„ÅÆ„Éù„Çπ„Çø„Éº„Åå‰∏¶„Çì„Åß„ÅÑ„Çã„ÄÇ',
                fellowLawman: 'ÂâØ‰øùÂÆâÂÆò„ÅåÂêõ„ÅÆ„Éê„ÉÉ„Ç∏„Å´Ê∞ó„Å•„ÅÑ„Åü„ÄÇ„ÄåÂêåÂøó„ÇàÔºÅ„Çà„ÅÜ„Åì„ÅùÔºÅ„Äç',
                bounties: 'Ë≥ûÈáëÈ¶ñ:',
                bountyPete: 'üéØ Black Pete - $100 (Âç±Èô∫„Å™ÁÑ°Ê≥ïËÄÖ)',
                bountyWolves: 'üéØ „Ç™„Ç™„Ç´„Éü„ÅÆÁæ§„Çå - $30 (Âåó„ÅÆÈÅì„Çí‰∏ÄÊéÉ)',
                bountySnakes: 'üéØ Ëõá„ÅÆÂ∑£ - $20 (Á†ÇÊº†„ÅÆÊéÉÈô§)',
                huntPete: 'üéØ Black Pete„ÇíÁã©„Çã',
                huntWolves: 'üê∫ „Ç™„Ç™„Ç´„Éü„ÅÆÁæ§„Çå„ÇíÁã©„Çã',
                huntSnakes: 'üêç Ëõá„ÅÆÂ∑£„Çí‰∏ÄÊéÉ„Åô„Çã',
                wildernessText: 'ÂüÉ„Å£„ÅΩ„ÅÑÂπ≥Âéü„Å´Ë∏è„ÅøÂá∫„Åô„ÄÇÂ§™ÈôΩ„ÅåÂÆπËµ¶„Å™„ÅèÁÖß„Çä„Å§„Åë„Çã„ÄÇ',
                wolfAppears: 'üê∫ ÈáéÁîü„ÅÆ„Ç™„Ç™„Ç´„Éü„ÅåÁèæ„Çå„ÅüÔºÅ',
                foundCamp: 'ËçíÈáé„Çí„Åï„Åæ„Çà„ÅÑ„ÄÅÊîæÊ£Ñ„Åï„Çå„Åü„Ç≠„É£„É≥„Éó„ÇíË¶ã„Å§„Åë„Åü„ÄÇ',
                foundGold: (gold) => `Âè§„ÅÑÈûçË¢ã„Åã„Çâ${gold}„Ç¥„Éº„É´„Éâ„ÇíË¶ã„Å§„Åë„ÅüÔºÅ`,
                wildernessStretch: 'ËçíÈáé„ÅåÊûú„Å¶„Åó„Å™„ÅèÂ∫É„Åå„Çã„ÄÇ„Çµ„Éú„ÉÜ„É≥„ÅåÁÇπÂú®„Åó„Å¶„ÅÑ„Çã„ÄÇ',
                seeCanyon: 'ÈÅ†„Åè„Å´Black Pete„ÅåÊΩú„Çì„Åß„ÅÑ„Çã„Å®„ÅÑ„ÅÜÂ≥°Ë∞∑„ÅåË¶ã„Åà„Çã...',
                continueExploring: 'üèúÔ∏è Êé¢Á¥¢„ÇíÁ∂ö„Åë„Çã',
                headCanyon: '‚õ∞Ô∏è Â≥°Ë∞∑„Å∏Âêë„Åã„ÅÜ',
                returnTown: 'üè† Áî∫„Å´Êàª„Çã',
                canyonEnter: 'Â≥°Ë∞∑„ÅÆÂ£Å„ÅåÈ´ò„Åè„Åù„Å≥„ÅàÁ´ã„Å§„ÄÇ„Åì„Åì„ÅØÁÑ°Ê≥ïËÄÖ„ÅÆÈ†òÂüü„Å†„ÄÇ',
                spotSmoke: 'Â≥°Ë∞∑„ÅÆÂ••„Å´„Ç≠„É£„É≥„Éó„Éï„Ç°„Ç§„Ç¢„ÅÆÁÖô„ÅåË¶ã„Åà„Çã„ÄÇBlack Pete„ÅÆÈö†„ÇåÂÆ∂„Å´ÈÅï„ÅÑ„Å™„ÅÑ„ÄÇ',
                dangerWarning: '‚ö†Ô∏è Ë≠¶ÂëäÔºöÂç±Èô∫Âú∞Â∏ØÔºÅ',
                stormCamp: 'üî´ Á™ÅÊíÉ„Åô„Çã',
                sneakApproach: 'ü§´ Âøç„Å≥ÂØÑ„Çã',
                useDynamite: 'üß® „ÉÄ„Ç§„Éä„Éû„Ç§„Éà„Çí‰Ωø„ÅÜ',
                retreat: 'üèÉ Êí§ÈÄÄ„Åô„Çã',
                chargeIn: 'ÈäÉ„ÇíÊíÉ„Å°„Å™„Åå„Çâ„Ç≠„É£„É≥„Éó„Å´Á™ÅÊíÉ„Åô„ÇãÔºÅ',
                whoDares: '„ÄåË™∞„Å†ÔºÅÔºü„ÄçBlack Pete„ÅåÊ≠¶Âô®„ÇíÊßã„Åà„Çã„ÄÇ',
                bossBattle: '‚öîÔ∏è „Éú„ÇπÊà¶ÔºöBLACK PETEÔºÅ',
                sneakShadows: 'ÂΩ±„ÅÆ„Çà„ÅÜ„Å´Âøç„Å≥ÂØÑ„Çã...',
                sneakRoll: 'Èö†ÂØÜÂà§ÂÆö',
                sneakSuccess: 'ÊàêÂäüÔºÅ',
                foundStash: 'Pete„ÅÆÈö†„ÅóÂ†¥ÊâÄ„ÇíË¶ã„Å§„Åë„ÅüÔºÅ+$50„Ç¥„Éº„É´„ÉâÔºÅ',
                peteSpots: '„Åó„Åã„ÅóÂéª„ÇäÈöõ„Å´Pete„Å´Ë¶ã„Å§„Åã„Å£„ÅüÔºÅ',
                sneakFailed: 'Â§±ÊïóÔºÅ',
                steppedTwig: 'Âøç„Å≥ÂØÑ„Çç„ÅÜ„Å®„Åó„Åü„ÅåÂ∞èÊûù„ÇíË∏è„Çì„Åß„Åó„Åæ„Å£„Åü...',
                beenSpotted: 'Ë¶ã„Å§„Åã„Å£„ÅüÔºÅ',
                lightDynamite: '„ÉÄ„Ç§„Éä„Éû„Ç§„Éà„Å´ÁÅ´„Çí„Å§„Åë„Å¶„Ç≠„É£„É≥„Éó„Å´Êäï„ÅíËæº„ÇÄÔºÅ',
                boom: 'üí• „Éâ„Ç´„Éº„É≥ÔºÅÁàÜÁô∫„ÅåÂ≥°Ë∞∑„Å´Èüø„ÅèÔºÅ',
                peteTakes40: 'Black Pete„Å´40„ÉÄ„É°„Éº„Ç∏ÔºÅ',
                peteEmerges: 'ÂÇ∑„ÇíË≤†„ÅÑ„Å™„Åå„Çâ„ÇÇ„ÄÅPete„ÅåÁÖô„ÅÆ‰∏≠„Åã„ÇâÁèæ„Çå„Çã...',
                trackWolves: '„Ç™„Ç™„Ç´„Éü„ÅÆÁæ§„Çå„ÇíÂåó„ÅÆÈÅì„Åæ„ÅßËøΩË∑°„Åô„Çã...',
                alphaAttacks: 'üê∫ „É™„Éº„ÉÄ„Éº„ÅÆ„Ç™„Ç™„Ç´„Éü„ÅåË•≤„ÅÑ„Åã„Åã„ÇãÔºÅ',
                findSnakes: 'Á†ÇÊº†„ÅÆÂ≤©Â†¥„ÅßËõá„ÅÆÂ∑£„ÇíË¶ã„Å§„Åë„Åü...',
                snakeStrikes: 'üêç „Ç¨„É©„Ç¨„É©„Éò„Éì„ÅåË•≤„Å£„Å¶„Åç„ÅüÔºÅ',
                victory: 'üèÜ ÂãùÂà©ÔºÅ',
                youDefeated: (name) => `${name}„ÇíÂÄí„Åó„ÅüÔºÅ`,
                goldEarned: (gold) => `+${gold}„Ç¥„Éº„É´„ÉâÁç≤ÂæóÔºÅ`,
                repGain: '‚≠ê Ë©ïÂà§+5ÔºàÁÑ°Ê≥ïËÄÖ„ÇíË£Å„ÅÑ„ÅüÔºâ',
                bountyCollected: 'üí∞ Ë≥ûÈáëÁç≤ÂæóÔºö+$100„Ç¥„Éº„É´„ÉâÔºÅ',
                repLegend: '‚≠ê Ë©ïÂà§+50Ôºà‰ºùË™¨ÁöÑ„Å™ÂäüÁ∏æÔºÅÔºâ',
                continueExplore: 'üèúÔ∏è Êé¢Á¥¢„ÇíÁ∂ö„Åë„Çã',
                attack: '‚öîÔ∏è ÊîªÊíÉ',
                defend: 'üõ°Ô∏è Èò≤Âæ°',
                useBandage: 'ü©π ÂåÖÂ∏Ø„Çí‰Ωø„ÅÜ',
                drinkWhiskey: 'ü•É „Ç¶„Ç§„Çπ„Ç≠„Éº„ÇíÈ£≤„ÇÄ',
                throwDynamite: 'üß® „ÉÄ„Ç§„Éä„Éû„Ç§„Éà„ÇíÊäï„Åí„Çã',
                hitRoll: 'ÂëΩ‰∏≠Âà§ÂÆö',
                hit: 'ÂëΩ‰∏≠ÔºÅ',
                critical: '„ÇØ„É™„ÉÜ„Ç£„Ç´„É´ÔºÅ',
                youDeal: '',
                damage: '„ÉÄ„É°„Éº„Ç∏ÔºÅ',
                miss: '„Éü„ÇπÔºÅ',
                attacks: '„ÅÆÊîªÊíÉÔºÅ',
                youTake: '',
                defended: 'ÔºàÈò≤Âæ°Ôºâ',
                dodged: '„ÇíÂõûÈÅø„Åó„ÅüÔºÅ',
                braceAttack: 'ÊîªÊíÉ„Å´ÂÇô„Åà„Çã...',
                usedBandage: 'ü©π ÂåÖÂ∏Ø„Çí‰Ωø„Å£„ÅüÔºÅ+20 HP',
                drankWhiskey: 'ü•É „Ç¶„Ç§„Çπ„Ç≠„ÉºÔºÅ+15 HP„ÄÅ+2 STRÔºÅ',
                dynamiteBoom: 'üß® „Éâ„Ç´„Éº„É≥ÔºÅ40„ÉÄ„É°„Éº„Ç∏ÔºÅ',
                enemyStunned: 'Êïµ„Åå„Çπ„Çø„É≥„Åó„ÅüÔºÅ',
                stoleGold: (gold) => `üí∞ ${gold}„Ç¥„Éº„É´„ÉâÁõó„Çì„Å†ÔºÅ`,
                gameOver: 'üíÄ „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº',
                metEnd: (name, className) => `${name}„ÅØÂüÉ„Å£„ÅΩ„ÅÑ„Éï„É≠„É≥„ÉÜ„Ç£„Ç¢„ÅßÊúÄÊúü„ÇíËøé„Åà„Åü...`,
                gold: '„Ç¥„Éº„É´„Éâ',
                enemiesDefeated: 'ÂÄí„Åó„ÅüÊïµ',
                daysSurvived: 'ÁîüÂ≠òÊó•Êï∞',
                newGame: '‚ñ∂ „Éã„É•„Éº„Ç≤„Éº„É†',
                playAgainBtn: 'üîÑ „ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§',
                endingTitle: 'üåÖ ÁµÇÂπï üåÖ',
                endingText: (name) => `Â≥°Ë∞∑„Å´Á†ÇÂüÉ„ÅåËàû„ÅÑËêΩ„Å°„Çã„ÄÇBlack Pete„ÅØÂêõ„ÅÆË∂≥ÂÖÉ„Å´ÂÄí„Çå„Å¶„ÅÑ„Çã„ÄÇÂêõ„ÅÆÂãùÂà©„ÅÆÁü•„Çâ„Åõ„ÅØ„ÄÅÈáéÁÅ´„ÅÆ„Çà„ÅÜ„Å´„Éï„É≠„É≥„ÉÜ„Ç£„Ç¢‰∏≠„Å´Â∫É„Åå„Å£„Åü„ÄÇDusty Gulch„Å´Êàª„Çã„Å®„ÄÅÁî∫„ÅÆ‰∫∫„ÄÖ„ÅåÈÄö„Çä„Å´ÈõÜ„Åæ„Å£„Å¶„ÅÑ„Åü„ÄÇ`,
                endingGasp: '„Äå„ÅäÂâç„ÅØ...‰ªä„Åæ„ÅßË¶ã„Åü‰∏≠„Åß‰∏ÄÁï™ÈÄü„ÅÑ„Äç',
                endingCheers: (name) => `„Äå${name}„Å´‰πæÊùØÔºÅ„ÄçÁæ§Ë°Ü„ÅåÂè´„Å∂„ÄÇ`,
                endingMayor: '„Äå„Åì„ÅÆÁî∫„ÅØÂêõ„Å´ÂÖ®„Å¶„ÇíÂÄü„Çä„Åå„ÅÇ„Çã„ÄÇ‰ªäÊó•„Åã„Çâ„ÅÇ„Å™„Åü„Åì„Åù„ÅåDusty Gulch„ÅÆÁúü„ÅÆÊ≥ï„Å†„Äç',
                legendWest: 'üèÜ Âêõ„ÅØË•øÈÉ®„ÅÆ‰ºùË™¨„Å®„Å™„Å£„ÅüÔºÅüèÜ',
                finalStats: 'ÊúÄÁµÇ„Çπ„ÉÜ„Éº„Çø„Çπ:',
                reputation: 'Ë©ïÂà§',
                remember: '„Éï„É≠„É≥„ÉÜ„Ç£„Ç¢„ÅØÂêõ„ÅÆÂêçÂâç„ÇíÊ∞∏ÈÅ†„Å´Ë®òÊÜ∂„Åô„Çã„Å†„Çç„ÅÜ...'
            }
        };
        
        function T(key, ...args) {
            const text = TEXTS[lang][key];
            return typeof text === 'function' ? text(...args) : text;
        }
        
        function toggleLang() {
            lang = lang === 'en' ? 'jp' : 'en';
            localStorage.setItem('dustyTrails_lang', lang);
            document.getElementById('lang-toggle').textContent = lang === 'en' ? 'üáØüáµ JP' : 'üá∫üá∏ EN';
            document.getElementById('subtitle').textContent = T('subtitle');
            // Refresh current scene if in game
            if (currentScene && player) {
                showScene(currentScene);
            } else if (!player) {
                showCharacterCreation();
            }
        }
        
        // Initialize language button
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('lang-toggle').textContent = lang === 'en' ? 'üáØüáµ JP' : 'üá∫üá∏ EN';
            document.getElementById('subtitle').textContent = T('subtitle');
        });
        
        // Game state
        let player = null;
        let currentScene = null;
        let gameDay = 1;
        let enemies = [];
        let inCombat = false;
        let currentEnemy = null;
        
        // Character classes with special abilities
        const CLASSES = {
            gunslinger: {
                name: 'Gunslinger',
                icon: 'üî´',
                desc: 'Fast and deadly. Lives by the gun.',
                hp: 80, str: 12, dex: 14, lck: 8,
                startItems: ['revolver', 'bullets_12'],
                special: { name: 'Fan the Hammer', desc: '3 rapid shots (3x damage)', cooldown: 3, dmgMult: 3 }
            },
            sheriff: {
                name: 'Sheriff',
                icon: '‚≠ê',
                desc: 'Tough and righteous. The law of the land.',
                hp: 100, str: 10, dex: 10, lck: 10,
                startItems: ['badge', 'revolver', 'bandage'],
                special: { name: 'Stand Your Ground', desc: 'Heal 30 HP & +5 DEF this turn', cooldown: 4, heal: 30 }
            },
            outlaw: {
                name: 'Outlaw',
                icon: 'ü§†',
                desc: 'Lucky and cunning. Takes what they want.',
                hp: 70, str: 8, dex: 12, lck: 14,
                startItems: ['knife', 'lockpick', 'whiskey'],
                special: { name: 'Dirty Trick', desc: 'Stun enemy (skip their turn) + steal gold', cooldown: 3, stun: true }
            },
            prospector: {
                name: 'Prospector',
                icon: '‚õèÔ∏è',
                desc: 'Hardy and lucky. Seeking fortune.',
                hp: 90, str: 14, dex: 6, lck: 12,
                startItems: ['pickaxe', 'dynamite', 'gold_nugget'],
                special: { name: 'Dynamite Blast', desc: 'Massive explosion (50 damage)', cooldown: 5, flatDmg: 50 }
            }
        };
        
        // Items
        const ITEMS = {
            revolver: { name: 'Revolver', icon: 'üî´', type: 'weapon', damage: 15 },
            knife: { name: 'Knife', icon: 'üî™', type: 'weapon', damage: 8 },
            pickaxe: { name: 'Pickaxe', icon: '‚õèÔ∏è', type: 'weapon', damage: 12 },
            rifle: { name: 'Rifle', icon: 'üéØ', type: 'weapon', damage: 25 },
            bandage: { name: 'Bandage', icon: 'ü©π', type: 'heal', heal: 20 },
            whiskey: { name: 'Whiskey', icon: 'ü•É', type: 'heal', heal: 15, strBoost: 2 },
            dynamite: { name: 'Dynamite', icon: 'üß®', type: 'combat', damage: 40 },
            gold_nugget: { name: 'Gold Nugget', icon: '‚ú®', type: 'valuable', value: 50 },
            bullets_12: { name: 'Bullets x12', icon: 'üîò', type: 'ammo', qty: 12 },
            badge: { name: "Sheriff's Badge", icon: '‚≠ê', type: 'special', effect: 'respect' },
            lockpick: { name: 'Lockpick', icon: 'üîë', type: 'tool' },
            horse: { name: 'Horse', icon: 'üê¥', type: 'mount', speed: 2 }
        };
        
        // Enemies
        const ENEMY_TYPES = {
            bandit: { name: 'Bandit', icon: 'ü§†', hp: 40, str: 8, dex: 8, gold: 20 },
            outlaw: { name: 'Outlaw', icon: 'üòà', hp: 60, str: 12, dex: 10, gold: 40 },
            wolf: { name: 'Wild Wolf', icon: 'üê∫', hp: 30, str: 10, dex: 12, gold: 5 },
            snake: { name: 'Rattlesnake', icon: 'üêç', hp: 15, str: 15, dex: 14, gold: 0 },
            bear: { name: 'Grizzly Bear', icon: 'üêª', hp: 80, str: 18, dex: 6, gold: 10 },
            scorpion: { name: 'Giant Scorpion', icon: 'ü¶Ç', hp: 25, str: 12, dex: 16, gold: 8 },
            vulture: { name: 'Vulture Swarm', icon: 'ü¶Ö', hp: 35, str: 6, dex: 18, gold: 3 },
            coyote: { name: 'Coyote Pack', icon: 'üêï', hp: 45, str: 9, dex: 14, gold: 12 },
            desperado: { name: 'Desperado', icon: 'üî´', hp: 70, str: 14, dex: 12, gold: 55 },
            boss_sheriff: { name: 'Corrupt Sheriff', icon: 'üëÆ', hp: 100, str: 14, dex: 12, gold: 100 },
            boss_gang: { name: 'Gang Leader', icon: 'üíÄ', hp: 120, str: 16, dex: 14, gold: 150 }
        };
        
        // DOM elements
        const storyArea = document.getElementById('story-area');
        const choicesArea = document.getElementById('choices-area');
        const statsBar = document.getElementById('stats-bar');
        const combatArea = document.getElementById('combat-area');
        const inventoryEl = document.getElementById('inventory');
        const gameOverEl = document.getElementById('game-over');
        
        // Initialize
        function startGame() {
            player = null;
            currentScene = null;
            gameDay = 1;
            inCombat = false;
            gameOverEl.classList.remove('visible', 'victory');
            statsBar.classList.remove('visible');
            combatArea.classList.remove('visible');
            inventoryEl.classList.remove('visible');
            showCharacterCreation();
        }
        
        function showCharacterCreation() {
            storyArea.innerHTML = `
                <div id="char-create">
                    <h2>${T('createChar')}</h2>
                    <p class="narrator">${T('yearIs')}</p>
                    <input type="text" id="char-name" placeholder="${T('enterName')}" maxlength="12">
                    <p class="narrator">${T('choosePath')}</p>
                    <div class="class-select">
                        ${Object.entries(CLASSES).map(([key, c]) => `
                            <div class="class-card" data-class="${key}">
                                <div class="icon">${c.icon}</div>
                                <div class="name">${c.name}</div>
                                <div class="desc">${c.desc}</div>
                                <div class="stats-preview">HP:${c.hp} STR:${c.str} DEX:${c.dex} LCK:${c.lck}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            choicesArea.innerHTML = '';
            
            // Add class selection listeners
            document.querySelectorAll('.class-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                });
            });
            
            // Add start button after a class is selected
            setTimeout(() => {
                choicesArea.innerHTML = `
                    <button class="choice-btn" onclick="createCharacter()">
                        <span class="key">[ENTER]</span> ${T('beginJourney')}
                    </button>
                `;
            }, 500);
        }
        
        function createCharacter() {
            const nameInput = document.getElementById('char-name');
            const selectedClass = document.querySelector('.class-card.selected');
            
            if (!selectedClass) {
                addStory('system', 'Choose a class first!');
                return;
            }
            
            const className = selectedClass.dataset.class;
            const classData = CLASSES[className];
            const name = nameInput.value.trim() || 'Stranger';
            
            player = {
                name: name,
                class: className,
                classData: classData,
                hp: classData.hp,
                maxHp: classData.hp,
                str: classData.str,
                dex: classData.dex,
                lck: classData.lck,
                gold: 10,
                inventory: [...classData.startItems],
                reputation: 0,
                kills: 0,
                specialCooldown: 0
            };
            
            playSound('click');
            
            statsBar.classList.add('visible');
            updateStats();
            
            showScene('intro');
        }
        
        function updateStats() {
            document.getElementById('hp').textContent = `${player.hp}/${player.maxHp}`;
            document.getElementById('str').textContent = player.str;
            document.getElementById('dex').textContent = player.dex;
            document.getElementById('lck').textContent = player.lck;
            document.getElementById('gold').textContent = player.gold;
            
            // Reputation display
            const repEl = document.getElementById('rep');
            const repValue = player.reputation;
            repEl.textContent = repValue >= 0 ? `+${repValue}` : repValue;
            repEl.className = 'stat-value ' + (repValue > 0 ? 'rep-good' : repValue < 0 ? 'rep-bad' : 'rep-neutral');
        }
        
        function addStory(type, text) {
            const p = document.createElement('p');
            p.className = type;
            p.innerHTML = text;
            storyArea.appendChild(p);
            storyArea.scrollTop = storyArea.scrollHeight;
        }
        
        function clearStory() {
            storyArea.innerHTML = '';
        }
        
        function showChoices(choices) {
            choicesArea.innerHTML = choices.map((c, i) => `
                <button class="choice-btn" onclick="handleChoice('${c.action}')" ${c.disabled ? 'disabled' : ''}>
                    <span class="key">[${i + 1}]</span> ${c.text}
                </button>
            `).join('');
        }
        
        // Scenes
        const SCENES = {
            intro: {
                text: () => `
                    <p class="narrator">${T('introText', player.name, player.classData.name)}</p>
                    <p class="dialogue">${T('welcome')}</p>
                    <p class="narrator">${T('mainStreet')}</p>
                `,
                choices: () => [
                    { text: T('saloon'), action: 'saloon' },
                    { text: T('store'), action: 'store' },
                    { text: T('sheriff'), action: 'sheriff' },
                    { text: T('wilderness'), action: 'wilderness' }
                ]
            },
            saloon: {
                text: () => `
                    <p class="narrator">${T('saloonEnter')}</p>
                    <p class="narrator"><span class="dialogue">${T('bartender')}</span></p>
                    ${Math.random() < 0.3 ? `<p class="system">${lang === 'jp' ? 'ÈöÖ„Å´„ÅÑ„ÇãËçí„Åè„ÇåËÄÖ„ÅåÂêõ„ÇíÁù®„Çì„Åß„ÅÑ„Çã...' : 'A rough-looking man in the corner stares at you menacingly...'}</p>` : ''}
                `,
                choices: () => {
                    const choices = [
                        { text: T('buyDrink'), action: 'buy_drink', disabled: player.gold < 5 },
                        { text: T('playPoker'), action: 'poker', disabled: player.gold < 10 },
                        { text: T('listenRumors'), action: 'rumors' },
                        { text: T('leave'), action: 'intro' }
                    ];
                    if (Math.random() < 0.3) {
                        choices.splice(2, 0, { text: T('confrontStranger'), action: 'bar_fight' });
                    }
                    return choices;
                }
            },
            buy_drink: {
                text: () => {
                    player.gold -= 5;
                    player.hp = Math.min(player.maxHp, player.hp + 10);
                    updateStats();
                    return `
                        <p class="narrator">${T('drinkText')}</p>
                        <p class="loot">${T('hpRestored')}</p>
                        <p class="dialogue">${T('bountyInfo')}</p>
                    `;
                },
                choices: () => [
                    { text: T('playPoker'), action: 'poker', disabled: player.gold < 10 },
                    { text: T('askBlackPete'), action: 'bounty_info' },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            poker: {
                text: () => {
                    const roll = rollDice(20) + Math.floor(player.lck / 2);
                    let result;
                    if (roll >= 18) {
                        player.gold += 30;
                        playSound('coin'); playSound('victory');
                        result = `<p class="loot">${T('jackpot')}</p>`;
                    } else if (roll >= 12) {
                        player.gold += 10;
                        playSound('coin');
                        result = `<p class="loot">${T('winHand')}</p>`;
                    } else if (roll >= 6) {
                        result = `<p class="narrator">${T('breakEven')}</p>`;
                        player.gold -= 10;
                        player.gold += 10;
                    } else {
                        player.gold -= 10;
                        playSound('hit');
                        result = `<p class="combat">${T('badLuck')}</p>`;
                    }
                    updateStats();
                    return `
                        <p class="narrator">${T('pokerSit')}</p>
                        <p class="system">üé≤ ${T('luckRoll')}: ${roll}</p>
                        ${result}
                    `;
                },
                choices: () => [
                    { text: T('playAgain'), action: 'poker', disabled: player.gold < 10 },
                    { text: T('leaveTable'), action: 'saloon' }
                ]
            },
            rumors: {
                text: () => {
                    const rumorsArr = T('rumors');
                    return `
                        <p class="narrator">${lang === 'jp' ? '„Éê„Éº„Å´„ÇÇ„Åü„Çå„Åã„Åã„Çä„ÄÅË©±„ÅóÂ£∞„Å´ËÄ≥„ÇíÂÇæ„Åë„Çã...' : 'You lean against the bar, listening to the chatter...'}</p>
                        <p class="dialogue">"${rumorsArr[Math.floor(Math.random() * rumorsArr.length)]}"</p>
                    `;
                },
                choices: () => [
                    { text: T('listenMore'), action: 'rumors' },
                    { text: T('buyDrink'), action: 'buy_drink', disabled: player.gold < 5 },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            bar_fight: {
                text: () => {
                    startCombat('bandit');
                    return `
                        <p class="narrator">${lang === 'jp' ? '„Çà„ÅùËÄÖ„Å´Ëøë„Å•„Åè„ÄÇÂΩº„ÅØÁ´ã„Å°‰∏ä„Åå„Çä„ÄÅ„Éõ„É´„Çπ„Çø„Éº„Å´Êâã„Çí„Åã„Åë„Çã„ÄÇ' : 'You approach the stranger. He stands, hand on his holster.'}</p>
                        <p class="dialogue">${lang === 'jp' ? '„Äå‰Ωï„ÅãÊñáÂè•„Åå„ÅÇ„Çã„ÅÆ„Åã„ÄÅ„Çà„ÅùËÄÖÔºü„Äç' : '"You got a problem, stranger?"'}</p>
                        <p class="combat">${lang === 'jp' ? '‚öîÔ∏è Êà¶ÈóòÈñãÂßãÔºÅ' : '‚öîÔ∏è COMBAT INITIATED!'}</p>
                    `;
                },
                choices: []
            },
            store: {
                text: () => `
                    <p class="narrator">${T('storeEnter')}</p>
                    <p class="dialogue">${T('storeKeeper')}</p>
                `,
                choices: () => [
                    { text: T('buyBandage'), action: 'buy_bandage', disabled: player.gold < 15 },
                    { text: 'ü•É Buy Whiskey ($10)', action: 'buy_whiskey', disabled: player.gold < 10 },
                    { text: T('buyDynamite'), action: 'buy_dynamite', disabled: player.gold < 25 },
                    { text: T('sellItems'), action: 'sell_items' },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            buy_bandage: {
                text: () => {
                    player.gold -= 15;
                    player.inventory.push('bandage');
                    updateStats();
                    return `<p class="loot">${T('purchased')} Bandage! ü©π</p>`;
                },
                choices: () => [
                    { text: T('buyMore'), action: 'store' },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            buy_whiskey: {
                text: () => {
                    player.gold -= 10;
                    player.inventory.push('whiskey');
                    updateStats();
                    return `<p class="loot">${T('purchased')} Whiskey! ü•É</p>`;
                },
                choices: () => [
                    { text: T('buyMore'), action: 'store' },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            buy_dynamite: {
                text: () => {
                    player.gold -= 25;
                    player.inventory.push('dynamite');
                    updateStats();
                    return `<p class="loot">${T('purchased')} Dynamite! üß®</p>`;
                },
                choices: () => [
                    { text: T('buyMore'), action: 'store' },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            sheriff: {
                text: () => {
                    const hasBadge = player.inventory.includes('badge');
                    return `
                        <p class="narrator">${T('sheriffOffice')}</p>
                        ${hasBadge ? `<p class="narrator">${T('fellowLawman')}</p>` : ''}
                        <p class="narrator">${T('bounties')}</p>
                        <p class="system">${T('bountyPete')}</p>
                        <p class="system">${T('bountyWolves')}</p>
                        <p class="system">${T('bountySnakes')}</p>
                    `;
                },
                choices: () => [
                    { text: T('huntPete'), action: 'bounty_pete' },
                    { text: T('huntWolves'), action: 'bounty_wolves' },
                    { text: T('huntSnakes'), action: 'bounty_snakes' },
                    { text: T('leave'), action: 'intro' }
                ]
            },
            wilderness: {
                text: () => {
                    const encounter = Math.random();
                    if (encounter < 0.3) {
                        return `
                            <p class="narrator">${T('wildernessText')}</p>
                            <p class="combat">${T('wolfAppears')}</p>
                        `;
                    } else if (encounter < 0.5) {
                        const goldFound = rollDice(10) + player.lck;
                        player.gold += goldFound;
                        updateStats();
                        return `
                            <p class="narrator">${T('foundCamp')}</p>
                            <p class="loot">${T('foundGold', goldFound)}</p>
                        `;
                    } else {
                        return `
                            <p class="narrator">${T('wildernessStretch')}</p>
                            <p class="narrator">${T('seeCanyon')}</p>
                        `;
                    }
                },
                choices: () => {
                    if (Math.random() < 0.3) {
                        startCombat('wolf');
                        return [];
                    }
                    return [
                        { text: T('continueExploring'), action: 'wilderness' },
                        { text: T('headCanyon'), action: 'canyon_entrance' },
                        { text: T('returnTown'), action: 'intro' }
                    ];
                }
            },
            canyon_entrance: {
                text: () => `
                    <p class="narrator">${T('canyonEnter')}</p>
                    <p class="narrator">${T('spotSmoke')}</p>
                    <p class="system">${T('dangerWarning')}</p>
                `,
                choices: () => [
                    { text: T('stormCamp'), action: 'pete_fight' },
                    { text: T('sneakApproach'), action: 'pete_sneak' },
                    { text: T('useDynamite'), action: 'pete_dynamite', disabled: !player.inventory.includes('dynamite') },
                    { text: T('retreat'), action: 'wilderness' }
                ]
            },
            pete_fight: {
                text: () => {
                    startCombat('boss_gang');
                    return `
                        <p class="narrator">${T('chargeIn')}</p>
                        <p class="dialogue">${T('whoDares')}</p>
                        <p class="combat">${T('bossBattle')}</p>
                    `;
                },
                choices: []
            },
            pete_sneak: {
                text: () => {
                    const roll = rollDice(20) + Math.floor(player.dex / 2);
                    if (roll >= 15) {
                        player.gold += 50;
                        updateStats();
                        return `
                            <p class="narrator">${T('sneakShadows')}</p>
                            <p class="system">üé≤ ${T('sneakRoll')}: ${roll} - ${T('sneakSuccess')}</p>
                            <p class="loot">${T('foundStash')}</p>
                            <p class="narrator">${T('peteSpots')}</p>
                        `;
                    } else {
                        return `
                            <p class="narrator">${T('steppedTwig')}</p>
                            <p class="system">üé≤ ${T('sneakRoll')}: ${roll} - ${T('sneakFailed')}</p>
                            <p class="combat">${T('beenSpotted')}</p>
                        `;
                    }
                },
                choices: () => {
                    startCombat('boss_gang');
                    return [];
                }
            },
            pete_dynamite: {
                text: () => {
                    player.inventory = player.inventory.filter(i => i !== 'dynamite');
                    currentEnemy = {...ENEMY_TYPES.boss_gang};
                    currentEnemy.hp -= 40;
                    return `
                        <p class="narrator">${T('lightDynamite')}</p>
                        <p class="combat">${T('boom')}</p>
                        <p class="loot">${T('peteTakes40')}</p>
                        <p class="narrator">${T('peteEmerges')}</p>
                    `;
                },
                choices: () => {
                    startCombat('boss_gang', currentEnemy);
                    return [];
                }
            },
            bounty_wolves: {
                text: () => {
                    startCombat('wolf');
                    return `
                        <p class="narrator">${T('trackWolves')}</p>
                        <p class="combat">${T('alphaAttacks')}</p>
                    `;
                },
                choices: []
            },
            bounty_snakes: {
                text: () => {
                    startCombat('snake');
                    return `
                        <p class="narrator">${T('findSnakes')}</p>
                        <p class="combat">${T('snakeStrikes')}</p>
                    `;
                },
                choices: []
            },
            victory: {
                text: () => `
                    <p class="narrator">üèÜ VICTORY!</p>
                    <p class="narrator">Your name echoes through the frontier. ${player.name} the ${player.classData.name} - a legend of the West!</p>
                `,
                choices: []
            },
            ending: {
                text: () => `
                    <p class="narrator">${T('endingTitle')}</p>
                    <p class="narrator">${T('endingText', player.name)}</p>
                    <p class="dialogue">${lang === 'jp' ? '„Äå„ÅäÂâç„ÅØ...‰ªä„Åæ„ÅßË¶ã„Åü‰∏≠„Åß‰∏ÄÁï™ÈÄü„ÅÑ„Äç' : '"You... you\'re faster than anyone I\'ve ever seen,"'}</p>
                    <p class="dialogue">${T('endingCheers', player.name)}</p>
                    <p class="dialogue">${T('endingMayor')}</p>
                    <p class="loot">${T('legendWest')}</p>
                    <p class="system">${T('finalStats')}</p>
                    <p class="system">üí∞ Gold: ${player.gold}</p>
                    <p class="system">üíÄ ${lang === 'jp' ? 'ÂÄí„Åó„ÅüÊïµ' : 'Enemies Defeated'}: ${player.kills}</p>
                    <p class="system">‚≠ê ${lang === 'jp' ? 'Ë©ïÂà§' : 'Reputation'}: ${player.reputation}</p>
                    <p class="narrator">${T('remember')}</p>
                    <p class="narrator">${player.name} the ${player.classData.name}</p>
                `,
                choices: [
                    { text: lang === 'jp' ? 'üîÑ „ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§' : 'üîÑ Play Again', action: 'restart' }
                ]
            },
            restart: {
                text: () => { startGame(); return ''; },
                choices: []
            }
        };
        
        function showScene(sceneName) {
            currentScene = sceneName;
            const scene = SCENES[sceneName];
            if (!scene) {
                console.error('Unknown scene:', sceneName);
                return;
            }
            
            clearStory();
            const text = typeof scene.text === 'function' ? scene.text() : scene.text;
            storyArea.innerHTML = text;
            
            if (!inCombat) {
                const choices = typeof scene.choices === 'function' ? scene.choices() : scene.choices;
                if (choices && choices.length > 0) {
                    showChoices(choices);
                }
            }
        }
        
        function handleChoice(action) {
            if (SCENES[action]) {
                showScene(action);
            }
        }
        
        // Combat system
        function rollDice(sides) {
            return Math.floor(Math.random() * sides) + 1;
        }
        
        function startCombat(enemyType, existingEnemy = null) {
            inCombat = true;
            currentEnemy = existingEnemy || {...ENEMY_TYPES[enemyType]};
            currentEnemy.maxHp = currentEnemy.maxHp || currentEnemy.hp;
            
            combatArea.classList.add('visible');
            document.getElementById('player-name').textContent = player.name;
            document.getElementById('enemy-name').textContent = currentEnemy.name + ' ' + currentEnemy.icon;
            
            updateCombatUI();
            document.getElementById('combat-log').innerHTML = '';
            
            showCombatChoices();
        }
        
        function updateCombatUI() {
            const playerHpPct = (player.hp / player.maxHp) * 100;
            const enemyHpPct = (currentEnemy.hp / currentEnemy.maxHp) * 100;
            
            document.getElementById('player-hp-bar').style.width = playerHpPct + '%';
            document.getElementById('enemy-hp-bar').style.width = enemyHpPct + '%';
            document.getElementById('player-hp-text').textContent = player.hp;
            document.getElementById('enemy-hp-text').textContent = currentEnemy.hp;
            updateStats();
        }
        
        function addCombatLog(text, type = '') {
            const log = document.getElementById('combat-log');
            const p = document.createElement('p');
            p.className = type;
            p.innerHTML = text;
            log.appendChild(p);
            log.scrollTop = log.scrollHeight;
        }
        
        function showCombatChoices() {
            const hasBandage = player.inventory.includes('bandage');
            const hasWhiskey = player.inventory.includes('whiskey');
            const hasDynamite = player.inventory.includes('dynamite');
            const special = player.classData.special;
            const canUseSpecial = player.specialCooldown === 0;
            
            const choices = [
                { text: T('attack'), action: 'combat_attack' },
                { text: T('defend'), action: 'combat_defend' }
            ];
            
            // Add special ability
            const turnText = lang === 'jp' ? '„Çø„Éº„É≥' : 'turns';
            const specialText = canUseSpecial 
                ? `‚ö° ${special.name}` 
                : `‚ö° ${special.name} (${player.specialCooldown} ${turnText})`;
            choices.push({ text: specialText, action: 'combat_special', disabled: !canUseSpecial });
            
            if (hasBandage) choices.push({ text: T('useBandage'), action: 'combat_bandage' });
            if (hasWhiskey) choices.push({ text: T('drinkWhiskey'), action: 'combat_whiskey' });
            if (hasDynamite) choices.push({ text: T('throwDynamite'), action: 'combat_dynamite' });
            
            showChoices(choices);
        }
        
        function playerAttack() {
            const weapon = player.inventory.find(i => ITEMS[i]?.type === 'weapon');
            const weaponDamage = weapon ? ITEMS[weapon].damage : 5;
            
            const hitRoll = rollDice(20) + Math.floor(player.dex / 3);
            const critRoll = rollDice(20);
            const isCrit = critRoll >= 18;
            
            playSound('gunshot');
            
            if (hitRoll >= 8) {
                let damage = weaponDamage + Math.floor(player.str / 2) + rollDice(6);
                if (isCrit) damage *= 2;
                
                currentEnemy.hp -= damage;
                addCombatLog(`üé≤ ${T('hitRoll')}: ${hitRoll} - ${T('hit')}${isCrit ? ' ' + T('critical') : ''}`, 'loot');
                addCombatLog(`${T('youDeal')} <span class="dice-roll">${damage}</span> ${T('damage')}`, 'combat');
            } else {
                addCombatLog(`üé≤ ${T('hitRoll')}: ${hitRoll} - ${T('miss')}`, 'system');
            }
            
            if (player.specialCooldown > 0) player.specialCooldown--;
        }
        
        // Special ability function
        function useSpecialAbility() {
            const special = player.classData.special;
            playSound('gunshot');
            playSound('gunshot');
            
            if (special.dmgMult) {
                // Gunslinger: Fan the Hammer
                const weapon = player.inventory.find(i => ITEMS[i]?.type === 'weapon');
                const weaponDamage = weapon ? ITEMS[weapon].damage : 5;
                let damage = (weaponDamage + player.str) * special.dmgMult;
                currentEnemy.hp -= damage;
                addCombatLog(`‚ö° ${special.name}! 3 rapid shots!`, 'loot');
                addCombatLog(`üí• ${damage} total damage!`, 'combat');
            } else if (special.heal) {
                // Sheriff: Stand Your Ground
                player.hp = Math.min(player.maxHp, player.hp + special.heal);
                addCombatLog(`‚ö° ${special.name}! +${special.heal} HP restored!`, 'loot');
                playSound('coin');
            } else if (special.stun) {
                // Outlaw: Dirty Trick
                const stolenGold = Math.min(currentEnemy.gold, 10 + rollDice(10));
                player.gold += stolenGold;
                currentEnemy.stunned = true;
                addCombatLog(`‚ö° ${special.name}! Enemy stunned!`, 'loot');
                addCombatLog(`üí∞ Stole ${stolenGold} gold!`, 'loot');
                playSound('coin');
            } else if (special.flatDmg) {
                // Prospector: Dynamite Blast
                currentEnemy.hp -= special.flatDmg;
                addCombatLog(`‚ö° ${special.name}! üí• BOOM!`, 'loot');
                addCombatLog(`üß® ${special.flatDmg} explosion damage!`, 'combat');
            }
            
            player.specialCooldown = special.cooldown;
            updateStats();
        }
        
        function enemyAttack(defended = false) {
            const hitRoll = rollDice(20) + Math.floor(currentEnemy.dex / 3);
            const playerDodge = rollDice(20) + Math.floor(player.dex / 3);
            
            if (hitRoll > playerDodge) {
                let damage = currentEnemy.str + rollDice(4);
                if (defended) damage = Math.floor(damage / 2);
                
                player.hp -= damage;
                playSound('hit');
                addCombatLog(`${currentEnemy.icon} attacks! üé≤ ${hitRoll} vs ${playerDodge}`, 'system');
                addCombatLog(`You take <span class="dice-roll">${damage}</span> damage!${defended ? ' (defended)' : ''}`, 'combat');
            } else {
                addCombatLog(`${currentEnemy.icon} attacks but you dodge! üé≤ ${hitRoll} vs ${playerDodge}`, 'loot');
            }
        }
        
        function combatTurn(action) {
            // Check if enemy is stunned
            const enemyStunned = currentEnemy.stunned;
            if (enemyStunned) currentEnemy.stunned = false;
            
            switch(action) {
                case 'combat_attack':
                    playerAttack();
                    if (currentEnemy.hp > 0 && !enemyStunned) enemyAttack();
                    break;
                case 'combat_defend':
                    addCombatLog('You brace for the attack...', 'system');
                    if (!enemyStunned) enemyAttack(true);
                    else addCombatLog('Enemy is stunned!', 'loot');
                    break;
                case 'combat_special':
                    useSpecialAbility();
                    if (currentEnemy.hp > 0 && !enemyStunned && !player.classData.special.stun) enemyAttack();
                    break;
                case 'combat_bandage':
                    player.inventory = player.inventory.filter(i => i !== 'bandage');
                    player.hp = Math.min(player.maxHp, player.hp + 20);
                    addCombatLog('ü©π You use a bandage! +20 HP', 'loot');
                    playSound('coin');
                    if (!enemyStunned) enemyAttack();
                    break;
                case 'combat_whiskey':
                    player.inventory = player.inventory.filter(i => i !== 'whiskey');
                    player.hp = Math.min(player.maxHp, player.hp + 15);
                    player.str += 2;
                    addCombatLog('ü•É Whiskey! +15 HP, +2 STR!', 'loot');
                    playSound('coin');
                    if (!enemyStunned) enemyAttack();
                    break;
                case 'combat_dynamite':
                    player.inventory = player.inventory.filter(i => i !== 'dynamite');
                    currentEnemy.hp -= 40;
                    addCombatLog('üß® BOOM! 40 damage!', 'combat');
                    playSound('hit');
                    if (currentEnemy.hp > 0 && !enemyStunned) enemyAttack();
                    break;
            }
            
            updateCombatUI();
            
            // Check victory/defeat
            if (currentEnemy.hp <= 0) {
                endCombat(true);
            } else if (player.hp <= 0) {
                endCombat(false);
            } else {
                showCombatChoices();
            }
        }
        
        function endCombat(victory) {
            inCombat = false;
            combatArea.classList.remove('visible');
            
            if (victory) {
                player.kills++;
                playSound('victory');
                const goldEarned = currentEnemy.gold + rollDice(10);
                player.gold += goldEarned;
                
                // Reputation gain for defeating outlaws
                if (['bandit', 'outlaw', 'desperado'].includes(currentEnemy.name?.toLowerCase())) {
                    player.reputation += 5;
                    addStory('system', T('repGain'));
                }
                
                updateStats();
                
                addStory('loot', `${T('victory')} ${T('youDefeated', currentEnemy.name)}`);
                addStory('loot', T('goldEarned', goldEarned));
                
                // Check for boss victory - Show epic ending
                if (currentEnemy.name === 'Gang Leader') {
                    player.gold += 100; // Bounty
                    player.reputation += 50;
                    updateStats();
                    addStory('loot', T('bountyCollected'));
                    addStory('system', T('repLegend'));
                    showScene('ending');
                    return;
                }
                
                showChoices([
                    { text: T('returnTown'), action: 'intro' },
                    { text: T('continueExplore'), action: 'wilderness' }
                ]);
            } else {
                playSound('death');
                showGameOver(false);
            }
        }
        
        function showGameOver(victory) {
            gameOverEl.classList.add('visible');
            if (victory) {
                gameOverEl.classList.add('victory');
                document.getElementById('go-title').textContent = T('legendWest');
                document.getElementById('go-message').textContent = `${player.name} the ${player.classData.name} ${lang === 'jp' ? '„ÅØË•øÈÉ®„ÅÆ‰ºùË™¨„Å®„Å™„Å£„ÅüÔºÅ' : 'has become a legend of the West!'}`;
            } else {
                document.getElementById('go-title').textContent = T('gameOver');
                document.getElementById('go-message').textContent = T('metEnd', player.name, player.classData.name);
            }
            document.getElementById('go-stats').innerHTML = `
                ${T('gold')}: ${player.gold}<br>
                ${T('enemiesDefeated')}: ${player.kills}<br>
                ${lang === 'jp' ? 'ÁîüÂ≠òÊó•Êï∞' : 'Days Survived'}: ${gameDay}
            `;
        }
        
        // Handle choice for both story and combat
        function handleChoice(action) {
            if (action.startsWith('combat_')) {
                combatTurn(action);
            } else if (SCENES[action]) {
                showScene(action);
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            const num = parseInt(e.key);
            if (num >= 1 && num <= 9) {
                const buttons = choicesArea.querySelectorAll('.choice-btn:not([disabled])');
                if (buttons[num - 1]) {
                    buttons[num - 1].click();
                }
            }
        });
        
        // Start!
        startGame();
    </script>
</body>
</html>
